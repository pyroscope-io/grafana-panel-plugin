name: 'lint-plugin'
inputs:
  enable-version-analyzer:
    description: 'Whether to analyze the version or not'
    required: true
  file:
    description: 'the plugin file (.zip)'
    required: true
runs:
  using: "composite"
  steps:
  - run: echo test
    shell: bash
  - name: prepare config file
    shell: bash -euxo pipefail {0}
    run: envsubst < lint.config.yaml > lint.config.yaml
  - run: echo $(cat lint.config.yaml)
    shell: bash
  - run: echo "$(<lint.config.yaml)"
    shell: bash
  - name: Lint plugin
    shell: bash
    run: |
      export PATH="$(go env GOPATH)/bin/:$PATH"
      git clone https://github.com/grafana/plugin-validator
      pushd ./plugin-validator/pkg/cmd/plugincheck2
      git log -1
      go install
      popd

      plugincheck2 -strict -config lint.config.yaml -sourceCodeUri=file://./ ${{ inputs.file }}
    env:
      ENABLE_VERSION_ANALYZER: ${{ inputs.enable-version-analyzer }}
      DEBUG: 1

